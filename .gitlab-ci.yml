stages:
  - build_back
  - build_front
  - test_front

variables:
  CI: "false"
  MYSQL_ROOT_PASSWORD: comsc
  MYSQL_DATABASE: bt_router_db
  DB_HOST: mysql

services:
  - name: mysql:latest
    alias: mysql
    command:
      - --default-authentication-plugin==mysql_native_password
      - --bind-address=0.0.0.0
      - --skip-networking=0

before_script:
  - apt-get update -y && apt-get install -y curl unzip
  - apt-get install -y -qq --no-install-recommends default-mysql-client

build_back:
  stage: build_back
  image: maven:3.9.0-eclipse-temurin-17
  script:
    - cd backend
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - backend/target/*.jar

build_front:
  stage: build_front
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm run build
  artifacts:
    paths:
      - frontend/build


test_front:
  stage: test_front
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm test -- --watchAll=false

  only:
    - main
